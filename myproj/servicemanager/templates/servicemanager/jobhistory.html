{% extends 'master.html' %}
{% load static%}
{% load tz %}



{% block content %}
<div class="page-head">
    <h4 class="mt-2 mb-2">Job History</h4>
</div>
<div class="basic-table">
    <div class="row">
        <div class="col-lg-12 col-sm-12">
            <div class="card m-b-30">
                <div class="card-body">
                    <form  id="jobHistory" class="form" role="form" action="{% url "filterData" %}" method="POST">
                        {% csrf_token %}
                    <div class="row m-b-30">
                        <div class="col-sm-6 col-lg-6">
                                From:&nbsp;<input type="text" id="txtFromDate" name="txtFromDate" />&nbsp;&nbsp;
                                To:&nbsp;<input type="text" id="txtToDate" name="txtToDate" />&nbsp;&nbsp;
                                <button style="float:right" type="submit" class="btn btn-dark btn-sm">Filter</button>
                        </div>
                    </div>
                    <button style="float:right" onclick="refreshJobList()" type="button" class="btn btn-dark btn-sm">Refresh</button>
                    <button style="float:left" type="button" id="btnClear" class="btn btn-dark btn-sm mr-1">Clear</button>
                    <button style="float:left" type="button" id="btnDelete" class="btn btn-dark btn-sm" onclick="deleteRecord()">Delete</button>
                    <span id="users" style="display:none">
                        {% for u in Users %}
                            {{u.username}},
                        {% endfor%}
                    </span>
                    <span id="loggedInUser" style="display:none">{{request.user.username}}</span>
                    <table id="tblTasks" class="table-responsive hover table table-striped table-bordered" style="border-radius:10px;width:100%">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Action</th>
                                <th>User</th>
                                {% for col in colNames %}
                                    {% if col.name == "Station" or col.name == "RegressionName" or col.name == "Tool" or col.name == "TotalIterations" or col.name == "Platform" or col.name == "CreatedDate" or col.name == "Status" or col.name == "ModifiedDate" or col.name == "ErrorMessage" %}
                                        <th>{{ col.name }}</th>
                                    {% endif %}
                                {% endfor %}
                                <th>Frodo Suggestions</th>
                                <th>Iteration Result</th>
                                <th>Test Results</th>
                                <th>Axon Log</th>
                                <th>Azure Link</th>
                            </tr>
                            
                        </thead>
                        <tbody>
                            
                            {% for task in tasks %}
                                <tr>
                                    <td>{% include './_delete.html' with taskID=task.id GUID=task.GUID status=task.Status loggedInUser=request.user.username user=task.CreatedBy %}</td>
                                    <td>{% include './_run.html' with taskID=task.id GUID=task.GUID status=task.Status loggedInUser=request.user.username user=task.CreatedBy %}</td>
                                    <td>{{ task.CreatedBy }}</td>
                                    <td>{{ task.Station }}</td>
                                    <td><a href='#' onclick=showDetail({{task.id}})><p style="text-decoration:underline">{{ task.RegressionName }}</p></td>
                                    <td>{{ task.Tool }}</td>
                                    <td>{{ task.CurrentIteration }} / {{ task.TotalIterations }}</td>
                                    <td>{{ task.Platform }}</td>
                                    <td>{{ task.CreatedDate|localtime }}</td>
                                    <td>{{ task.Status }}</td>
                                    <td>{{ task.ModifiedDate|default_if_none:"" }}</td>
                                    <td>{{ task.ErrorMesage }}</td>
                                    <td>{% include './_iterationslist.html' with iterationsData=iterations taskID=task.id GUID=task.GUID %}</td>
                                    <td>{{ task.IterationResult }}</td>
                                    <td>{{ task.TestResults }}</td>
                                    <td>{{ task.AxonLog }}</td>
                                    <td><a href="{{task.AzureLink}}" target="_blank">{{ task.AzureLink }}</a></td>
                                </tr>
                            {% endfor %}
                        </tbody>
                     </table>
                    </form>
                    </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade bd-example-modal-lg" id="jobJson" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">JSON</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <pre id="jsonData"></pre>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div> 

<div class="modal fade bd-example-modal-lg" id="iterationJson" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">JSON</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <pre id="iterationjsonData"></pre>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div> 

{% endblock %}
{% block extrajs %}

{% endblock %}



